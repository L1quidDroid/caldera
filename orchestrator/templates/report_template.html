<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Report - {{ campaign_id }}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        /* Triskele Labs Branding */
        :root {
            --triskele-green: #48CFA0;
            --triskele-dark: #020816;
            --triskele-gray: #6B7280;
            --neutral-100: #F3F4F6;
            --neutral-200: #E5E7EB;
            --neutral-800: #1F2937;
            --success: #48CFA0;
            --warning: #F59E0B;
            --error: #EF4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--neutral-800);
            line-height: 1.6;
            font-size: 11pt;
        }
        
        /* Page setup */
        @page {
            size: letter;
            margin: 0.75in;
            @top-right {
                content: "Page " counter(page);
                font-size: 9pt;
                color: var(--triskele-gray);
            }
            @bottom-left {
                content: "Generated by Caldera Orchestrator - Triskele Labs";
                font-size: 8pt;
                color: var(--triskele-gray);
            }
        }
        
        /* Cover page */
        .cover {
            page-break-after: always;
            text-align: center;
            padding-top: 3in;
        }
        
        .cover .logo {
            font-size: 48pt;
            font-weight: 700;
            color: var(--triskele-green);
            margin-bottom: 0.5in;
            letter-spacing: -2px;
        }
        
        .cover .title {
            font-size: 28pt;
            font-weight: 700;
            color: var(--triskele-dark);
            margin-bottom: 0.3in;
            line-height: 1.2;
        }
        
        .cover .subtitle {
            font-size: 16pt;
            color: var(--triskele-gray);
            margin-bottom: 0.2in;
        }
        
        .cover .campaign-id {
            font-size: 12pt;
            color: var(--triskele-gray);
            font-family: 'Courier New', monospace;
            background: var(--neutral-100);
            padding: 12pt;
            border-radius: 8pt;
            display: inline-block;
            margin-top: 0.3in;
        }
        
        .cover .metadata {
            margin-top: 1in;
            font-size: 10pt;
            color: var(--triskele-gray);
        }
        
        /* Section styling */
        .section {
            page-break-inside: avoid;
            margin-bottom: 24pt;
        }
        
        h1 {
            font-size: 20pt;
            font-weight: 700;
            color: var(--triskele-dark);
            border-bottom: 3pt solid var(--triskele-green);
            padding-bottom: 8pt;
            margin-top: 24pt;
            margin-bottom: 16pt;
            page-break-after: avoid;
        }
        
        h2 {
            font-size: 16pt;
            font-weight: 600;
            color: var(--triskele-dark);
            margin-top: 20pt;
            margin-bottom: 12pt;
            page-break-after: avoid;
        }
        
        h3 {
            font-size: 13pt;
            font-weight: 600;
            color: var(--triskele-gray);
            margin-top: 16pt;
            margin-bottom: 10pt;
            page-break-after: avoid;
        }
        
        /* Metrics grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16pt;
            margin: 20pt 0;
        }
        
        .metric-card {
            background: var(--neutral-100);
            padding: 16pt;
            border-radius: 8pt;
            border-left: 4pt solid var(--triskele-green);
            page-break-inside: avoid;
        }
        
        .metric-value {
            font-size: 24pt;
            font-weight: 700;
            color: var(--triskele-green);
            line-height: 1;
        }
        
        .metric-label {
            font-size: 10pt;
            color: var(--triskele-gray);
            margin-top: 4pt;
            font-weight: 500;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16pt 0;
            font-size: 10pt;
            page-break-inside: auto;
        }
        
        thead {
            background: var(--triskele-dark);
            color: white;
        }
        
        th {
            padding: 10pt;
            text-align: left;
            font-weight: 600;
            border-bottom: 2pt solid var(--triskele-green);
        }
        
        td {
            padding: 10pt;
            border-bottom: 1pt solid var(--neutral-200);
        }
        
        tbody tr:nth-child(even) {
            background: var(--neutral-100);
        }
        
        tbody tr:hover {
            background: rgba(72, 207, 160, 0.1);
        }
        
        /* Status badges */
        .badge {
            display: inline-block;
            padding: 4pt 8pt;
            border-radius: 4pt;
            font-size: 9pt;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: var(--success);
            color: white;
        }
        
        .badge-warning {
            background: var(--warning);
            color: white;
        }
        
        .badge-error {
            background: var(--error);
            color: white;
        }
        
        .badge-neutral {
            background: var(--neutral-200);
            color: var(--neutral-800);
        }
        
        /* Charts */
        .chart {
            text-align: center;
            margin: 20pt 0;
            page-break-inside: avoid;
        }
        
        .chart img {
            max-width: 100%;
            height: auto;
        }
        
        /* Lists */
        ul, ol {
            margin-left: 20pt;
            margin-bottom: 12pt;
        }
        
        li {
            margin-bottom: 6pt;
        }
        
        /* Code blocks */
        .code {
            background: var(--neutral-100);
            padding: 12pt;
            border-radius: 6pt;
            font-family: 'Courier New', monospace;
            font-size: 9pt;
            overflow-x: auto;
            border-left: 3pt solid var(--triskele-green);
            margin: 12pt 0;
        }
        
        /* Timeline */
        .timeline-item {
            padding: 12pt;
            border-left: 3pt solid var(--triskele-green);
            margin-left: 20pt;
            margin-bottom: 12pt;
            position: relative;
            page-break-inside: avoid;
        }
        
        .timeline-item::before {
            content: '';
            width: 12pt;
            height: 12pt;
            background: var(--triskele-green);
            border-radius: 50%;
            position: absolute;
            left: -7.5pt;
            top: 14pt;
        }
        
        .timeline-time {
            font-size: 9pt;
            color: var(--triskele-gray);
            font-weight: 600;
        }
        
        .timeline-event {
            font-weight: 600;
            color: var(--triskele-dark);
            margin-top: 4pt;
        }
        
        /* Page breaks */
        .page-break {
            page-break-after: always;
        }
        
        .no-break {
            page-break-inside: avoid;
        }
        
        /* Footer info */
        .report-footer {
            margin-top: 40pt;
            padding-top: 16pt;
            border-top: 2pt solid var(--neutral-200);
            font-size: 9pt;
            color: var(--triskele-gray);
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Cover Page -->
    <div class="cover">
        <div class="logo">TRISKELE LABS</div>
        <div class="title">Campaign Report</div>
        <div class="subtitle">Adversary Emulation Assessment</div>
        <div class="campaign-id">Campaign ID: {{ campaign_id }}</div>
        <div class="metadata">
            <p>Generated: {{ generated_at }}</p>
            <p>Caldera Global Orchestration Platform</p>
        </div>
    </div>
    
    <!-- Executive Summary -->
    <h1>Executive Summary</h1>
    <div class="section">
        <p style="font-size: 12pt; margin-bottom: 16pt;">
            This report provides a comprehensive analysis of the adversary emulation campaign
            <strong>{{ campaign_id }}</strong>, executed using the MITRE Caldera framework with
            Triskele Labs' Global Orchestration Pattern.
        </p>
        
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">{{ summary.total_operations }}</div>
                <div class="metric-label">Operations Executed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ summary.total_agents }}</div>
                <div class="metric-label">Agents Deployed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ summary.total_abilities_executed }}</div>
                <div class="metric-label">Abilities Executed</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ "%.1f"|format(summary.success_rate) }}%</div>
                <div class="metric-label">Success Rate</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ "%.1f"|format(summary.duration_hours) }}h</div>
                <div class="metric-label">Campaign Duration</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">{{ summary.platforms|length }}</div>
                <div class="metric-label">Platforms Tested</div>
            </div>
        </div>
    </div>
    
    <!-- Success Rate Chart -->
    {% if charts.success_rate %}
    <div class="chart">
        <h2>Success Rate Analysis</h2>
        <img src="{{ charts.success_rate }}" alt="Success Rate Chart">
    </div>
    {% endif %}
    
    <div class="page-break"></div>
    
    <!-- Operations Overview -->
    <h1>Operations Overview</h1>
    <div class="section">
        <table>
            <thead>
                <tr>
                    <th>Operation Name</th>
                    <th>Adversary</th>
                    <th>Agents</th>
                    <th>Abilities</th>
                    <th>State</th>
                    <th>Duration</th>
                </tr>
            </thead>
            <tbody>
                {% for op in operations %}
                <tr>
                    <td><strong>{{ op.name }}</strong></td>
                    <td>{{ op.adversary }}</td>
                    <td>{{ op.agent_count }}</td>
                    <td>{{ op.chain|length }}</td>
                    <td>
                        {% if op.state == 'finished' %}
                        <span class="badge badge-success">{{ op.state }}</span>
                        {% elif op.state == 'running' %}
                        <span class="badge badge-warning">{{ op.state }}</span>
                        {% else %}
                        <span class="badge badge-neutral">{{ op.state }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if op.start_time and op.finish_time %}
                        {{ ((op.finish_time|string|length > 0) and "Completed" or "In Progress") }}
                        {% else %}
                        N/A
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Platform Distribution -->
    {% if charts.platform_distribution %}
    <div class="chart">
        <h2>Platform Distribution</h2>
        <img src="{{ charts.platform_distribution }}" alt="Platform Distribution">
    </div>
    {% endif %}
    
    <div class="page-break"></div>
    
    <!-- ATT&CK Technique Coverage -->
    <h1>ATT&CK Technique Coverage</h1>
    <div class="section">
        <p>The following MITRE ATT&CK techniques were executed during this campaign:</p>
        
        <table>
            <thead>
                <tr>
                    <th>Technique ID</th>
                    <th>Executions</th>
                    <th>Successful</th>
                    <th>Failed</th>
                    <th>Success Rate</th>
                </tr>
            </thead>
            <tbody>
                {% for tech_id, data in techniques.items() %}
                {% if tech_id != 'unknown' %}
                <tr>
                    <td><strong>{{ tech_id }}</strong></td>
                    <td>{{ data.count }}</td>
                    <td style="color: var(--success);">{{ data.success }}</td>
                    <td style="color: var(--error);">{{ data.failed }}</td>
                    <td>
                        {% set rate = (data.success / data.count * 100) if data.count > 0 else 0 %}
                        {% if rate >= 80 %}
                        <span class="badge badge-success">{{ "%.0f"|format(rate) }}%</span>
                        {% elif rate >= 50 %}
                        <span class="badge badge-warning">{{ "%.0f"|format(rate) }}%</span>
                        {% else %}
                        <span class="badge badge-error">{{ "%.0f"|format(rate) }}%</span>
                        {% endif %}
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Technique Heatmap -->
    {% if charts.technique_heatmap %}
    <div class="chart">
        <h2>Technique Execution by Tactic</h2>
        <img src="{{ charts.technique_heatmap }}" alt="Technique Heatmap">
    </div>
    {% endif %}
    
    <div class="page-break"></div>
    
    <!-- Agents -->
    <h1>Deployed Agents</h1>
    <div class="section">
        <table>
            <thead>
                <tr>
                    <th>Hostname</th>
                    <th>Platform</th>
                    <th>Architecture</th>
                    <th>Username</th>
                    <th>Group</th>
                    <th>Last Seen</th>
                </tr>
            </thead>
            <tbody>
                {% for agent in agents %}
                <tr>
                    <td><strong>{{ agent.hostname }}</strong></td>
                    <td>{{ agent.platform }}</td>
                    <td>{{ agent.architecture }}</td>
                    <td>{{ agent.username }}</td>
                    <td>{{ agent.group }}</td>
                    <td style="font-size: 9pt;">{{ agent.last_seen[:19] if agent.last_seen else 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Timeline -->
    {% if timeline %}
    <h1>Campaign Timeline</h1>
    <div class="section">
        {% for event in timeline[:20] %}
        <div class="timeline-item">
            <div class="timeline-time">{{ event.timestamp[:19] if event.timestamp else 'Unknown' }}</div>
            <div class="timeline-event">
                {% if 'started' in event.event %}
                üü¢ {{ event.operation_name }} started
                {% elif 'finished' in event.event %}
                üèÅ {{ event.operation_name }} finished
                {% else %}
                ‚ÑπÔ∏è {{ event.event }}
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    <div class="page-break"></div>
    
    <!-- Errors and Failures -->
    {% if errors %}
    <h1>Errors and Failures</h1>
    <div class="section">
        <p>The following abilities encountered errors during execution:</p>
        
        <table>
            <thead>
                <tr>
                    <th>Ability</th>
                    <th>Technique</th>
                    <th>Platform</th>
                    <th>Status Code</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody>
                {% for error in errors[:50] %}
                <tr>
                    <td>{{ error.ability }}</td>
                    <td>{{ error.technique_id or 'N/A' }}</td>
                    <td>{{ error.platform }}</td>
                    <td><span class="badge badge-error">{{ error.status_code }}</span></td>
                    <td style="font-size: 9pt;">{{ error.timestamp[:19] if error.timestamp else 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    <!-- ATT&CK Navigator Export -->
    {% if attack_layer_path %}
    <h1>ATT&CK Navigator Layer</h1>
    <div class="section">
        <p>An ATT&CK Navigator layer file has been generated for this campaign:</p>
        <div class="code">{{ attack_layer_path }}</div>
        <p>Import this file into the <a href="https://mitre-attack.github.io/attack-navigator/">MITRE ATT&CK Navigator</a> to visualize technique coverage.</p>
    </div>
    {% endif %}
    
    <!-- Footer -->
    <div class="report-footer">
        <p><strong>Triskele Labs</strong> - Global Orchestration for MITRE Caldera</p>
        <p>This report was automatically generated by the Caldera Orchestrator</p>
        <p>For more information, visit the project documentation</p>
    </div>
</body>
</html>
